<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Profile</title>
<link rel="stylesheet" href="profile.css">
</head>
<body>
<nav class="navbar">
  <a href="dashboard.html">Home</a>
  <a href="/logout">Logout</a>
</nav>

<div id="profileCard" class="profile-card"></div>

<!-- Update form hidden initially -->
<div id="updateSection" class="update-container" style="display:none;">
  <h2 style="text-align:center">Update Profile</h2>
  <form id="profileForm">
    <label>Height (cm)</label>
    <input type="number" name="height" required>
    <label>Weight (kg)</label>
    <input type="number" name="weight" required>
    <label>Goal</label>
    <select name="goal">
      <option value="weight_loss">Weight Loss</option>
      <option value="muscle_gain">Muscle Gain</option>
      <option value="maintain">Maintain Fitness</option>
    </select>
    <button type="submit">Update</button>
  </form>
</div>

<script>
  fetch('/api/profile')
  .then(res => res.json())
  .then(user => {
    document.getElementById("profileCard").innerHTML = `
      <img src="${user.profile_pic || 'images/user.jpg'}" alt="Profile Picture">
      <h3>${user.name}</h3>
      <p><strong>Email:</strong> ${user.email}</p>
      <p><strong>Age:</strong> ${user.age}</p>
      <p><strong>Gender:</strong> ${user.gender}</p>
      <p><strong>Height:</strong> ${user.height} cm</p>
      <p><strong>Weight:</strong> ${user.weight} kg</p>
      <p><strong>Goal:</strong> ${user.goal}</p>
      <button onclick="showUpdateForm(${user.height}, ${user.weight}, '${user.goal}')">Update Profile</button>
    `;
  });

function showUpdateForm(height, weight, goal) {
  document.getElementById("updateSection").style.display = "block";
  document.querySelector('input[name="height"]').value = height;
  document.querySelector('input[name="weight"]').value = weight;
  document.querySelector('select[name="goal"]').value = goal.toLowerCase();
}

// Update profile
document.getElementById('profileForm').addEventListener('submit', e => {
  e.preventDefault();
  const data = {
    height: document.querySelector('input[name="height"]').value,
    weight: document.querySelector('input[name="weight"]').value,
    goal: document.querySelector('select[name="goal"]').value
  };
  fetch('/api/update-profile', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(data)
  }).then(res => res.json())
    .then(res => alert(res.message));
});
</script>
</body>
</html>
